# W3ID .htaccess for chem-dcat-ap 
# DCAT-AP Plus Links to ...........................................
# Maintained by: NFDI4Chem & NFDI4Cat
# GitHub: https://github.com/nfdi-de/chem-dcat-ap 
# Contact: Koepler, Oliver <Oliver.Koepler@tib.eu>

Header set Access-Control-Allow-Origin "*"

# Enable rewrite engine
Options +FollowSymLinks
RewriteEngine on

# ====================================
# General HTML redirect to GitHub pages Documentation
# ====================================

RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^$ https://nfdi-de.github.io/chem-dcat-ap/ [R=302,L]

RewriteCond %{HTTP_ACCEPT} text/yaml [OR]
RewriteCond %{HTTP_ACCEPT} application/yaml
RewriteRule ^$ https://nfdi-de.github.io/chem-dcat-ap/latest/schema/chemical_entities_ap.yaml  [R=302,L]

RewriteCond %{HTTP_ACCEPT} application/ld\+json
RewriteRule ^$ https://nfdi-de.github.io/chem-dcat-ap/latest/schema/jsonld/chemical_entities_ap.jsonld  [R=302,L]

RewriteCond %{HTTP_ACCEPT} application/context\+ld\+json
RewriteRule ^$ https://nfdi-de.github.io/chem-dcat-ap/latest/schema/jsonld/chemical_entities_ap.context.jsonld  [R=302,L]

RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^$ https://nfdi-de.github.io/chem-dcat-ap/latest/schema/jsonschema/chemical_entities_ap.schema.json  [R=302,L]

RewriteCond %{HTTP_ACCEPT} text/turtle
RewriteRule ^$ https://nfdi-de.github.io/chem-dcat-ap/latest/schema/shacl/chemical_entities_ap.shacl.ttl [R=302,L]


# ====================================
# Datamodels
# ====================================

# main linkml yaml schema
RewriteCond %{HTTP_ACCEPT} application/yaml [OR]
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^v?([0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}[a-zA-Z0-9\-\.\+]*)/schema/chemical_entities_ap.yaml" https://nfdi-de.github.io/chem-dcat-ap/v$1/schema/chemical_entities_ap.yaml [R=302,L]
RewriteCond %{HTTP_ACCEPT} application/yaml [OR]
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^latest/schema/chemical_entities_ap.yaml" https://nfdi-de.github.io/chem-dcat-ap/latest/schema/chemical_entities_ap.yaml [R=302,L]

# ====================================
# Various artefacts
# ====================================



# HTML - individual documentation for class elements
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^v?([0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}[a-zA-Z0-9\-\.\+]*)/class/(.*)$" https://nfdi-de.github.io/chem-dcat-ap/v$1/elements/classes/$2 [R=303,L,NE,NC]
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^latest/class/(.*)$" https://nfdi-de.github.io/chem-dcat-ap/latest/elements/classes/$2 [R=303,L,NE,NC]

# HTML - individual documentation for slot elements
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^v?([0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}[a-zA-Z0-9\-\.\+]*)/slot/(.*)$" https://nfdi-de.github.io/chem-dcat-ap/v$1/elements/slots/$2 [R=303,L,NE,NC]
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^latest/slot/(.*)$" https://nfdi-de.github.io/chem-dcat-ap/latest/elements/slots/$2 [R=303,L,NE,NC]

# HTML - individual documentation for enum elements
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^v?([0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}[a-zA-Z0-9\-\.\+]*)/enum/(.*)$" https://nfdi-de.github.io/chem-dcat-ap/v$1/elements/enums/$2 [R=303,L,NE,NC]
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^latest/enum/(.*)$" https://nfdi-de.github.io/chem-dcat-ap/latest/elements/enums/$2 [R=303,L,NE,NC]

# HTML - individual documentation for type elements
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^v?([0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}[a-zA-Z0-9\-\.\+]*)/type/(.*)$" https://nfdi-de.github.io/chem-dcat-ap/v$1/elements/types/$2 [R=303,L,NE,NC]
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^latest/type/(.*)$" https://nfdi-de.github.io/chem-dcat-ap/latest/elements/types/$2 [R=303,L,NE,NC]


# HTML - schema documentation
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^v?([0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}[a-zA-Z0-9\-\.\+]*)/elements.*$" https://nfdi-de.github.io/chem-dcat-ap/v$1/elements/overview [R=303,L,NE,NC]
RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule "^latest/elements.*$" https://nfdi-de.github.io/chem-dcat-ap/latest/elements/overview [R=303,L,NE,NC]




# ====================================
# Fallback - redirect to main documentation
# ====================================
# Fallback to HTML for version-tagged and latest.
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule "^v?([0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}).*$" https://nfdi-de.github.io/chem-dcat-ap/v$1 [R=303,L,NE,NC]

RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule "^latest$" https://nfdi-de.github.io/chem-dcat-ap/latest [R=303,L,NE,NC]

# HTML - general documentation
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule "^.*$" https://nfdi-de.github.io/chem-dcat-ap/latest [R=303,L,NE,NC]