Options +FollowSymLinks
RewriteEngine on

# Directive to allow Cross origin requests
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Headers "Origin, X-Requested-With, Accept, Accept-Language"
Header always set Access-Control-Allow-Methods "GET, OPTIONS"


# Rewrite Base URL

RewriteRule ^$ https://profiles.adlnet.gov [R=302]

#######################################################################################################
#################### XAPI Profiles | HTML Content Negotiation RULES ###################################
#######################################################################################################

# Consolidated HTML Rules to account for vocab/profile pattern match up to four child paths after
# ---------------------------
# Serve HTML content at profile IRI if requested

RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^([0-9a-zA-Z\-]+)/?$ https://profiles.adlnet.gov/profiles [R=303]

RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://profiles.adlnet.gov/profiles [R=303]

RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://profiles.adlnet.gov/profiles [R=303]

RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://profiles.adlnet.gov/profiles [R=303]


#######################################################################################################
##################### XAPI Profiles | RDF Content Negotiation RULES ###################################
#######################################################################################################


# Serve JSON-LD at profile IRI if requested
RewriteCond %{HTTP_ACCEPT} application/ld\+json
RewriteRule ^([0-9a-zA-Z\-]+)/?$ https://profiles.adlnet.gov/api/profile?iri=https://w3id.org/xapi/$1 [R=303]


# Serve JSON at profile IRI if JSON is requested
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([0-9a-zA-Z\-]+)/?$ https://profiles.adlnet.gov/api/profile?iri=https://w3id.org/xapi/$1 [R=303]
