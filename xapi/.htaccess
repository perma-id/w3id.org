Options +FollowSymLinks
RewriteEngine on

# Directive to allow Cross origin requests
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Headers "Origin, X-Requested-With, Accept, Accept-Language"
Header always set Access-Control-Allow-Methods "GET, OPTIONS"


# Rewrite Base URL

RewriteRule ^$ http://xapi.vocab.pub [R=302]

#######################################################################################################
################################ xAPI Ontology & Statement Context ####################################
#######################################################################################################

# Ontology Rewrite rule to serve HTML content from the vocabulary URI if requested
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^ontology/?$ https://adlnet.github.io/xapi-ontology [R=303]

# Ontology Rewrite rule to serve RDF/XML content from the vocabulary URI if requested
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^ontology/?$ https://adlnet.github.io/xapi-ontology/ontology.rdf [R=303]

# Ontology Rewrite rule to serve Turtle content from the vocabulary URI if requested
RewriteCond %{HTTP_ACCEPT} text/turtle
RewriteRule ^ontology/?$ https://adlnet.github.io/xapi-ontology/ontology.ttl [R=303]

# JSON-LD xAPI STATEMENT CONTEXT
# Context for xAPI Statements published as constrained JSON-LD
RewriteCond %{HTTP_ACCEPT} application/ld\+json
RewriteRule ^statement-context$ https://adlnet.github.io/xapi-ontology/statement-context.jsonld [R=303]

# JSON-LD xAPI STATEMENT CONTEXT
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^statement-context$ https://adlnet.github.io/xapi-ontology/statement-context.jsonld [R=303]


#######################################################################################################
###################################### OLD adlnet.gov IRI RULES #######################################
#######################################################################################################

# Serve HTML content at profile IRI if requested based on redirect on old ADL website and also handle ADL's cmi5 verbs
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^adl/verbs/abandoned/?$ http://xapi.vocab.pub/describe/?url=https://w3id.org/xapi/adl/verbs/abandoned [R=303]
RewriteRule ^adl/verbs/satisfied/?$ http://xapi.vocab.pub/describe/?url=https://w3id.org/xapi/adl/verbs/satisfied [R=303]
RewriteRule ^adl/verbs/waived/?$ http://xapi.vocab.pub/describe/?url=https://w3id.org/xapi/adl/verbs/waived [R=303]
RewriteRule ^adl/verbs/logged-in/?$ http://xapi.vocab.pub/describe/?url=https://w3id.org/xapi/adl/verbs/logged-in [R=303]
RewriteRule ^adl/verbs/logged-out/?$ http://xapi.vocab.pub/describe/?url=https://w3id.org/xapi/adl/verbs/logged-out [R=303]


# Serve HTML content at profile IRI if requested based on redirect on old ADL website and also handle ADL's cmi5 verbs
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^adl/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ http://xapi.vocab.pub/describe/?url=http://adlnet.gov/expapi/$1/$2 [R=303]


#######################################################################################################
#################### XAPI Published Profiles | HTML Content Negotiation RULES #########################
#######################################################################################################

# Consolidated HTML Rules to account for vocab/profile pattern match and two child paths after
# ---------------------------
# Serve HTML content at profile IRI if requested
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^([0-9a-zA-Z\-]+)/?$ http://xapi.vocab.pub/describe/?url=https://w3id.org/xapi/$1 [R=303]

# Serve HTML content at profile IRI if x.x.x version requested
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^([0-9a-zA-Z\-]+)/v[0-9][0-9.]*/?$ http://xapi.vocab.pub/describe/?url=https://w3id.org/xapi/$1 [R=303]

# Serve HTML content at type IRI if requested
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ http://xapi.vocab.pub/describe/?url=https://w3id.org/xapi/$1 [R=303]

# Serve HTML content at vocabulary term IRI if requested
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ http://xapi.vocab.pub/describe/?url=https://w3id.org/xapi/$1/$2/$3 [R=303]

# Serve HTML content at vocabulary term IRI if requested
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ http://xapi.vocab.pub/describe/?url=https://w3id.org/xapi/$1/$2/$3/$4 [R=303]

#######################################################################################################
##################### XAPI Authored Profiles | RDF Content Negotiation RULES ##########################
#######################################################################################################

# Serve Turtle at profile IRI if requested
RewriteCond %{HTTP_ACCEPT} text/turtle
RewriteRule ^([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.ttl [R=303]

# Serve Turtle for the x.x.x version of the profile if requested
RewriteCond %{HTTP_ACCEPT} text/turtle
RewriteRule ^([0-9a-zA-Z\-]+)/v[0-9][0-9.]*/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$2/$1.ttl [R=303]

# Serve Turtle at vocabulary type IRI if requested
RewriteCond %{HTTP_ACCEPT} text/turtle
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.ttl [R=303]

# Serve Turtle at vocabulary term IRI if requested
RewriteCond %{HTTP_ACCEPT} text/turtle
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.ttl [R=303]

# Serve Turtle at vocabulary term IRI if requested
RewriteCond %{HTTP_ACCEPT} text/turtle
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.ttl [R=303]


# Serve JSON-LD at profile IRI if requested
RewriteCond %{HTTP_ACCEPT} application/ld\+json
RewriteRule ^([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.jsonld [R=303]

# Serve JSON-LD for the x.x.x version of the profile
RewriteCond %{HTTP_ACCEPT} application/ld\+json
RewriteRule ^([0-9a-zA-Z\-]+)/v[0-9][0-9.]*/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$2/$1.jsonld [R=303]

# Serve JSON-LD at vocabulary type IRI if requested
RewriteCond %{HTTP_ACCEPT} application/ld\+json
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.jsonld [R=303]

# Serve JSON-LD at vocabulary term IRI if requested
RewriteCond %{HTTP_ACCEPT} application/ld\+json
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.jsonld [R=303]

# Serve JSON-LD at vocabulary term IRI if requested
RewriteCond %{HTTP_ACCEPT} application/ld\+json
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.jsonld [R=303]

# Serve JSON-LD at vocabulary term IRI if requested
RewriteCond %{HTTP_ACCEPT} application/ld\+json
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.jsonld [R=303]



# Serve Constrained JSON-LD at profile IRI if JSON is requested
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.jsonld [R=303]

# Serve Constrained JSON-LD at profile IRI if x.x.x version and JSON is requested
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([0-9a-zA-Z\-]+)/v[0-9][0-9.]*/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$2/$1.jsonld [R=303]

# Serve Constrained JSON-LD at vocabulary type IRI if JSON is requested
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.jsonld [R=303]

# Serve Constrained JSON-LD at vocabulary term IRI if JSON is requested
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.jsonld [R=303]

# Serve Constrained JSON-LD at vocabulary term IRI if JSON is requested
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/([0-9a-zA-Z\-]+)/?$ https://adlnet.github.io/xapi-authored-profiles/$1/$1.jsonld [R=303]




#######################################################################################################
################################ ACROSS X LANGUAGE NEGOTIATION RULES ##################################
#######################################################################################################

# Serve zh-tw HTML content at vocabulary IRI if requested
RewriteCond %{HTTP:Accept-Language} ^zh-tw [NC]
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^acrossx/?$ http://xapi-cop.net/vocab/zh-tw [R=303]

# Serve zh-tw content at vocabulary term IRI if requested
RewriteCond %{HTTP:Accept-Language} ^zh-tw [NC]
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^acrossx/(.*)/(.*)$ http://xapi-cop.net/vocab/zh-tw/#$2 [R=303,NE]

# Serve zh-cn HTML content at vocabulary IRI if requested
RewriteCond %{HTTP:Accept-Language} ^zh-cn [NC]
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^acrossx/?$ http://xapi-cop.net/vocab/zh-cn [R=303]

# Serve zh-cn content at vocabulary term IRI if requested
RewriteCond %{HTTP:Accept-Language} ^zh-cn [NC]
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^acrossx/(.*)/(.*)$ http://xapi-cop.net/vocab/zh-cn/#$2 [R=303,NE]

# END ACROSSX VOCABULARY LANGUAGE NEGOTIATION RULES
# ---------------------------
