# https://w3id.org/citydata/ redirects to https://isotc204.org/ontology-cdm-p1/latest/
#
# ## Contact
# This space is administered by:
# The ISO/IEC 5087 series editors, including:
# Kenneth Vaughn
# kvaughn@trevilon.com
# GitHub username: k-vaughn

RewriteEngine On

# Set FORMAT based on Accept header for RDF formats
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml [OR]
RewriteCond %{HTTP_ACCEPT} text/turtle [OR]
RewriteCond %{HTTP_ACCEPT} application/ld\+json [OR]
RewriteCond %{HTTP_ACCEPT} application/n-triples [OR]
RewriteCond %{HTTP_ACCEPT} text/n3
RewriteRule ^ - [E=FORMAT:rdf]

RewriteCond %{HTTP_ACCEPT} text/html
RewriteRule ^ - [E=FORMAT:html]

# Default to RDF (OWL) if no Accept header (common for some tools; safer than HTML default for ontologies)
RewriteCond %{ENV:FORMAT} ^$
RewriteRule ^ - [E=FORMAT:rdf]


# Stable base IRI (no subpath): Redirect based on format (e.g., /part1/v1 -> p1-v1/latest, /part2/v1 -> p2-v1/latest)
# For RDF: Redirect to main ontology file
RewriteCond %{ENV:FORMAT} rdf
RewriteRule ^part(\d+)/v(\d+)$ https://isotc204.org/ontology-cdm-p$1-v$2/latest/5087-$1.owl [R=303,L]  # RDF (adjust if 5087 isn't part-specific)
# For HTML: Redirect to doc page
RewriteRule ^part(\d+)/v(\d+)$ https://isotc204.org/ontology-cdm-p$1-v$2/latest/ [R=303,L]

# Submodule-specific without version (e.g., /part1/v1/Agent -> p1-v1/latest/Agent)
RewriteCond %{ENV:FORMAT} rdf
RewriteRule ^part(\d+)/v(\d+)/([^/]+)$ https://isotc204.org/ontology-cdm-p$1-v$2/latest/$3.owl [R=303,L]  # $1=part#, $2=submodule
# For HTML: Submodule doc; update to /$2.html if per-file docs exist
RewriteRule ^part(\d+)/v(\d+)/([^/]+)$ https://isotc204.org/ontology-cdm-p$1-v$2/latest/$3 [R=303,L]

# Submodule with version (e.g., /part1/v1/Agent/r3.0 -> p1-v1/r3.0/Agent)
# This also handles versioned base if requested as /part1/v1/5087-1/r3.0
RewriteCond %{ENV:FORMAT} rdf
RewriteRule ^part(\d+)/v(\d+)/([^/]+)/([^/]+)$ https://isotc204.org/ontology-cdm-p$1-v$2/$4/$3.owl [R=303,L]  # $1=part#, $2=submodule, $3=version
# For HTML: Versioned submodule doc; update to /$2.html if per-file
RewriteRule ^part(\d+)/v(\d+)/([^/]+)/([^/]+)$ https://isotc204.org/ontology-cdm-p$1-v$2/$4/$3 [R=303,L]

# Fallback: Redirect to main page if no specific match
RewriteRule ^ https://isotc204.org/ontology-cdm-p1-v1/latest/ [R=303,L]