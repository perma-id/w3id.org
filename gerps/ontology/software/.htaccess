# =============================================================================
# GerPS Software Ontology - Content Negotiation
# Redirects to appropriate format based on Accept headers and language preference
# =============================================================================

# Disable MultiViews to prevent interference with content negotiation
Options -MultiViews

# Enable URL rewriting
RewriteEngine On

# =============================================================================
# German HTML
# =============================================================================
# Serves German HTML docs when Accept-Language starts with 'de'
# Base URL -> index-de.html#
# With version (eg "1.0/") -> 1.0/index-de.html#
# With fragment (e.g., 1.0/SomeTerm): redirects to 1.0/index-de.html#SomeTerm
RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP:Accept-Language} ^de [NC]
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^(\d+\.\d+\/)?(.*)?$ "https://fusion-jena.github.io/GerPS-Software/$1index-de.html#$2" [R=303,L,NE]

# =============================================================================
# English HTML
# =============================================================================
# Base URL -> index-en.html
# Base URL -> index-en.html#
# With version (eg "1.0/") -> 1.0/index-en.html#
# With fragment (e.g., 1.0/SomeTerm): redirects to 1.0/index-en.html#SomeTerm

RewriteCond %{HTTP_ACCEPT} !application/rdf\+xml.*(text/html|application/xhtml\+xml)
RewriteCond %{HTTP_ACCEPT} text/html [OR]
RewriteCond %{HTTP_ACCEPT} application/xhtml\+xml [OR]
RewriteCond %{HTTP_USER_AGENT} ^Mozilla/.*
RewriteRule ^(\d+\.\d+\/)?(.*)?$ "https://fusion-jena.github.io/GerPS-Software/$1index-en.html#$2" [R=303,L,NE]

# =============================================================================
# RDF Serialization Formats
# =============================================================================
# JSON-LD: application/ld+json -> ontology.jsonld
RewriteCond %{HTTP_ACCEPT} application/ld\+json
RewriteRule ^(\d+\.\d+\/)?.*$ https://fusion-jena.github.io/GerPS-Software/$1ontology.jsonld [R=303,L]

# RDF/XML: */* or application/rdf+xml -> ontology.owl
RewriteCond %{HTTP_ACCEPT} \*/\* [OR]
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^(\d+\.\d+\/)?.*$ https://fusion-jena.github.io/GerPS-Software/$1ontology.owl [R=303,L]

# N-Triples: application/n-triples -> ontology.nt
RewriteCond %{HTTP_ACCEPT} application/n-triples
RewriteRule ^(\d+\.\d+\/)?.*$ https://fusion-jena.github.io/GerPS-Software/$1ontology.nt [R=303,L]

# Turtle: text/turtle, text/*, or */turtle -> ontology.ttl
RewriteCond %{HTTP_ACCEPT} text/turtle [OR]
RewriteCond %{HTTP_ACCEPT} text/\* [OR]
RewriteCond %{HTTP_ACCEPT} \*/turtle 
RewriteRule ^(\d+\.\d+\/)?.*$ https://fusion-jena.github.io/GerPS-Software/$1ontology.ttl [R=303,L]

# =============================================================================
# Error Handling & Default
# =============================================================================
# 406 Not Acceptable if Accept header present but no format matched
RewriteCond %{HTTP_ACCEPT} .+
RewriteRule ^$ https://fusion-jena.github.io/GerPS-Software/406.html [R=406,L]

# Default: English documentation
RewriteRule ^$ https://fusion-jena.github.io/GerPS-Software/index-en.html [R=303,L]
