Header set Access-Control-Allow-Origin *

# MIME types for RDF serializations
AddType application/rdf+xml .rdf
AddType application/rdf+xml .owl
AddType text/turtle .ttl
AddType application/n-triples .nt
AddType application/ld+json .json
AddType application/ld+json .jsonld

Options +FollowSymLinks
RewriteEngine on

# =============================================================================
# GAIA-X 4 PLC AAD Ontologies - Resolver-based resolution
# Pattern: /{ontology}/v{version}[/][shapes]
# Uses GitHub Pages resolver backed by docs/registry.json
# =============================================================================

# Turtle / RDF-XML requests -> resolver
RewriteCond %{HTTP_ACCEPT} text/turtle [OR]
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^([^/]+)/(v[0-9]+|latest)/?$ https://gaia-x4plc-aad.github.io/ontology-management-base/resolve/?ontology=$1&version=$2&format=turtle [R=303,L]

# Turtle / RDF-XML shapes requests -> resolver
RewriteCond %{HTTP_ACCEPT} text/turtle [OR]
RewriteCond %{HTTP_ACCEPT} application/rdf\+xml
RewriteRule ^([^/]+)/(v[0-9]+|latest)/shapes/?$ https://gaia-x4plc-aad.github.io/ontology-management-base/resolve/?ontology=$1&version=$2&resource=shacl&format=turtle [R=303,L]

# JSON-LD requests -> resolver
RewriteCond %{HTTP_ACCEPT} application/ld\+json [OR]
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([^/]+)/(v[0-9]+|latest)/?$ https://gaia-x4plc-aad.github.io/ontology-management-base/resolve/?ontology=$1&version=$2&format=jsonld [R=303,L]

# JSON-LD shapes requests -> resolver
RewriteCond %{HTTP_ACCEPT} application/ld\+json [OR]
RewriteCond %{HTTP_ACCEPT} application/json
RewriteRule ^([^/]+)/(v[0-9]+|latest)/shapes/?$ https://gaia-x4plc-aad.github.io/ontology-management-base/resolve/?ontology=$1&version=$2&resource=shacl&format=jsonld [R=303,L]

# HTML fallback to docs
RewriteRule ^([^/]+)/(v[0-9]+|latest)/?$ https://gaia-x4plc-aad.github.io/ontology-management-base/ontologies/#$1 [R=303,L]
RewriteRule ^([^/]+)/(v[0-9]+|latest)/shapes/?$ https://gaia-x4plc-aad.github.io/ontology-management-base/ontologies/#$1 [R=303,L]

# Root redirect to docs
RewriteRule ^$ https://gaia-x4plc-aad.github.io/ontology-management-base/ontologies/ [R=303,L]
